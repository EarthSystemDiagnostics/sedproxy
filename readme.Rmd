---
title: "Sedproxy: Simulation of Sediment Archived Climate Proxy Records."
output: 
  html_document: 
    keep_md: yes
---

------------------------------

## Introduction

`sedproxy` provides a forward model for sediment archived climate proxies. It is based on work described in Laepple and Huybers (2013). A manuscript is in preparation, Dolman and Laepple (in prep.), which will more fully describe the forward model and its applications. Please contact Dr Andrew Dolman <<andrew.dolman@awi.de>>, or Dr Thomas Laepple <<tlaepple@awi.de>>, at the Alfred-Wegener-Institute, Helmholtz Centre for Polar and Marine Research, Germany, for more information.

 
## Installation

**sedproxy** can be installed directly from bitbucket

```{r, eval=FALSE}
if (!require("devtools")) {
  install.packages("devtools")
}

devtools::install_bitbucket("ecus/sedproxy")
```

## Example data

`sedproxy` includes example data for a single sediment core and location: core number 41 in the Shakun et al. (2012) compilation (`r sedproxy::N41.proxy.details$Core`, Rosenthal et al. 2003). The climate signal is taken from the [TraCE-21ka](http://www.cgd.ucar.edu/ccr/TraCE/) Simulation of Transient Climate Evolution over the last 21,000 years, using the grid cell closest to core `r sedproxy::N41.proxy.details$Core`. Seasonality of *G.ruber*, the Foraminifera for which test Mg/Ca ratios were measured, is taken from the model of Fraile et al (2008). Sediment accumulation rates were estimated from the depth and age data associated with core `r sedproxy::N41.proxy.details$Core`, with a minimum rate of 0.2 * the mean rate.


**The `r sedproxy::N41.proxy.details$Core` core**

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(knitr)
library(sedproxy)
```


```{r}
knitr::kable(N41.proxy.details %>% tidyr::gather(), format = "markdown")
```


**Modelled climate signal**

The first 5 rows:

```{r}
knitr::kable(N41.t21k.climate[1:5,], format = "markdown")
```

**Actual proxy record**

Core `r sedproxy::N41.proxy.details$Core` (Rosenthal et al. 2003)

```{r}
kable(head(N41.proxy), format = "markdown")
```

*******

## Function `ClimToProxyClim`

`ClimToProxyClim` is the main function in package `sedproxy`. It simulates a sediment archived proxy from an assumed true climate signal, the sediment accumulation rate, seasonality of the encoding organism/process, and the number of samples per timepoint.


```{r , fig.show='hold'}
set.seed(26052017)

PFM <- ClimToProxyClim(clim.signal = N41.t21k.climate[nrow(N41.t21k.climate):1,] - 273.15, 
                       timepoints = N41.proxy$Published.age,
                       proxy.calibration.type = "identity",
                seas.prod = N41.G.ruber.seasonality,
                sed.acc.rate = N41.proxy$Sed.acc.rate.m.yr,
                meas.noise = 0.46, n.samples = 30,
                n.replicates = 10)
```


```{r}
names(PFM)
```

```{r}
head(PFM$simulated.proxy)
```

**Simple plotting**

```{r default_plot, fig.width=6, fig.height=5.5}
plot.df <- PFM$simulated.proxy %>% 
  select(timepoints, clim.timepoints.50, proxy.bt, proxy.bt.sb,
         proxy.bt.sb.sampYM, proxy.bt.sb.sampYM.b.n) %>% 
  gather(Stage, Temperature, -timepoints) %>% 
  mutate(Age = timepoints,
         Temperature = Temperature) 

plot.df %>% 
  # Add Location and ID.no for plotting function 
  mutate(Location = "Sulu Sea", 
         ID.no = "N41") %>% 
  PlotPFMs(.)
```






**The 10 replicates of the final simulated proxy**

```{r}
head(PFM$everything$proxy.bt.sb.sampYM.b.n)
```



## Literature cited

Fraile, I., Schulz, M., Mulitza, S., & Kucera, M. (2008): Predicting the global distribution of planktonic foraminifera using a dynamic ecosystem model. Biogeosciences, 5: 891–911.

Laepple, T., & Huybers, P. (2013): Reconciling discrepancies between Uk37 and Mg/Ca reconstructions of Holocene marine temperature variability. Earth and Planetary Science Letters, 375: 418–429.

Rosenthal, Y., Oppo, D. W., & Linsley, B. K. (2003): The amplitude and phasing of climate change during the last deglaciation in the Sulu Sea, western equatorial Pacific. Geophys. Res. Lett., 30: 1428.

Shakun, J. D., Clark, P. U., He, F., Marcott, S. A., Mix, A. C., Liu, Z., Otto-Bliesner, B., Schmittner, A., & Bard, E. (2012): Global warming preceded by increasing carbon dioxide concentrations during the last deglaciation. Nature, 484: 49–54.


