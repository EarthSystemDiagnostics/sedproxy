<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sedproxy">
<title>Introduction to sedproxy • sedproxy</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to sedproxy">
<meta property="og:description" content="sedproxy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sedproxy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/effect-of-climate-dependent-flux.html">Effect of climate dependent flux.</a>
    <a class="dropdown-item" href="../articles/introduction-to-sedproxy.html">Introduction to sedproxy</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to sedproxy</h1>
                        <h4 data-toc-skip class="author">Andrew M. Dolman</h4>
            
            <h4 data-toc-skip class="date">2022-03-28</h4>
      
      
      <div class="d-none name"><code>introduction-to-sedproxy.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="what-is-a-proxy-forward-model-and-what-is-sedproxy">What is a “proxy forward model” and what is “sedproxy”?<a class="anchor" aria-label="anchor" href="#what-is-a-proxy-forward-model-and-what-is-sedproxy"></a>
</h3>
<p>A proxy forward model is a numerical model that takes a hypothetical “true” climate time-series and simulates the processes of proxy creation and retrieval. The output is a simulated proxy time-series that should resemble what a true proxy would look like given our assumed true climate.</p>
<p><strong>sedproxy</strong> is an R package that implements a forward model for climate proxies archived in marine sediments. The model is described in Dolman, A. M. and Laepple, T.: Sedproxy: a forward model for sediment-archived climate proxies, Climate of the Past, 14(12), 1851–1868, <a href="doi:https://doi.org/10.5194/cp-14-1851-2018" class="external-link uri">doi:https://doi.org/10.5194/cp-14-1851-2018</a>, 2018.</p>
<p>The tutorial is intended to get you started using sedproxy and to illustrate some of its possible applications.</p>
</div>
<div class="section level3">
<h3 id="setup---installing-sedproxy">Setup - installing sedproxy<a class="anchor" aria-label="anchor" href="#setup---installing-sedproxy"></a>
</h3>
<p><strong>sedproxy</strong> can be installed directly from github. Remove the comments marks “#” on the code below to install. If you are doing this tutorial on the RStudio Cloud sedproxy is already installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># if (!require("devtools")) {</span>
<span class="co">#   install.packages("devtools")</span>
<span class="co"># }</span>
<span class="co"># </span>
<span class="co"># devtools::install_github("EarthSystemDiagnostics/sedproxy")</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-input-climate">The input climate<a class="anchor" aria-label="anchor" href="#the-input-climate"></a>
</h3>
<p>The main function in the sedproxy package is <code>ClimToProxyClim</code> for Climate-To-Proxy-Climate, and its first argument is <code>clim.signal</code>. This is the “assumed true” past climate from which a proxy record will be modelled. This could be the output from a GCM, ESM, or a simple stochastic time series.</p>
<p>It should be a matrix with rows corresponding to years - with the most recent year at the top, going back in time as you go down the matrix (as if it were a sediment column!). In this example the columns of the matrix represent months of the year, but more generally the columns can also represent “habitats” such as different depths in the ocean at which the proxy creation process might take place.</p>
<p>The sedproxy package contains an example input climate taken from the Trace21k climate model run. It is the closest model grid box to core MD97-2141, from which there is a foraminiferal Mg/Ca record (record 41 in Shakun et al. 2012, Rosenthal et al., 2003).</p>
<p>The model data are in “time-forward” order so we need to reverse the order when we read it, and convert to °C from Kelvin.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo<span class="op">=</span><span class="cn">TRUE</span>, message <span class="op">=</span> <span class="cn">FALSE</span>, warning <span class="op">=</span> <span class="cn">FALSE</span>,
                      fig.width <span class="op">=</span> <span class="fl">6</span>, fig.height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://earthsystemdiagnostics.github.io/sedproxy/">sedproxy</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clim.in</span> <span class="op">&lt;-</span> <span class="va">N41.t21k.climate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">N41.t21k.climate</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">-</span> <span class="fl">273.15</span></code></pre></div>
<p>Additionally we need to turn it into an R time-series object. The Trace simulation runs to the year 1990 AD, therefore the start time for the input climate is -39 years BP.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clim.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="va">clim.in</span>, start <span class="op">=</span> <span class="op">-</span><span class="fl">39</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="timepoints">Timepoints<a class="anchor" aria-label="anchor" href="#timepoints"></a>
</h3>
<p>The second argument <code>timepoint</code> defines the points in time for which you want to model a proxy value. If you have a real proxy record you can use the estimated ages of your actual samples. Here we will define a regular time-series with a sample every 100 years.</p>
<p>Because of the bioturbation process, the modelled proxy value at each timepoint depends on values of the input climate both earlier and later in time than the timepoint itself. This time windows spans from 1 “bioturbation width” younger than the timepoint, and 3 bioturbation widths earlier in time. If timepoints are requested that cannot be returned, the model will still run, but with a warning that some timepoints have been omitted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req.timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20000</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="habitat-weights">Habitat weights<a class="anchor" aria-label="anchor" href="#habitat-weights"></a>
</h3>
<p><code>habitat.weights</code> define the relative abundance or flux of climate signal carriers (e.g. foraminiferal shells) corresponding to the habitats (here months) in the different columns of the input climate. For example, a particular taxa might be more abundant in the warm summer months than during the winter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hab.wts</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">pi</span>, <span class="fl">3</span><span class="op">*</span><span class="va">pi</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span>
<span class="va">hab.wts</span> <span class="op">&lt;-</span> <span class="va">hab.wts</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hab.wts</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hab.wts</span>, type <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="sediment-properties">Sediment properties<a class="anchor" aria-label="anchor" href="#sediment-properties"></a>
</h3>
<p>The bioturbation depth <code>bio.depth</code> and sedimentation rate <code>sed.acc.rate</code> control the amount of smoothing that takes place due to mixing of the sediment. For most marine sediment cores we do not currently have a measured estimate of the bioturbation depth. As a default we use a value of 10 cm as this is close to the mean observed for locations where this has been measured by particle tracers. The sedimentation rate can be estimated from a set of down-core depths and age estimates. For this example we will use a sedimentation rate of 10 cm / kyr as together with a sediment slice thickness (called <code>layer.width</code> in sedproxy) this implies a sampling interval of 100 years.</p>
</div>
<div class="section level3">
<h3 id="additional-error-terms">Additional error terms<a class="anchor" aria-label="anchor" href="#additional-error-terms"></a>
</h3>
<p>The sedproxy forward model simulates measurement error as a simple normal/Gaussian distributed random variable, the argument <code>sigma.meas</code> sets the standard deviation of this error. Here we set it to 0.25 °C</p>
<p>Additionally, inter-individual error is modelled as a normally distributed error term, <code>sigma.ind</code>, here set to 1 °C. The argument <code>n.samples</code> controls the number of signal carriers (e.g. forams) measured together in a single sample. The inter-individual error is scaled by the square root of <code>n.samples</code> as a mean is effectively taken over this number of individuals, here 30.</p>
</div>
<div class="section level3">
<h3 id="running-the-proxy-forward-model">Running the proxy forward model<a class="anchor" aria-label="anchor" href="#running-the-proxy-forward-model"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PFM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
                       timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
                       habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
                       sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
                       sigma.meas <span class="op">=</span> <span class="fl">0.25</span>,
                       sigma.ind <span class="op">=</span> <span class="fl">1</span>,
                       n.samples <span class="op">=</span> <span class="fl">30</span>,
                       
                       <span class="co"># this controls the resolution at which the input climate</span>
                       <span class="co"># is returned and will be plotted later</span>
                       plot.sig.res <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>There is a plotting function that by default plots all of the modelled stages of proxy creation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/PlotPFMs.html">PlotPFMs</a></span><span class="op">(</span><span class="va">PFM</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>If we repeat the call to <code>ClimToProxyClim</code> with n.replicates &gt; 1 we will get multiple realisations of the simulated proxy.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PFM.5.reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
                       timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
                       habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
                       sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
                       sigma.meas <span class="op">=</span> <span class="fl">0.25</span>,
                       sigma.ind <span class="op">=</span> <span class="fl">1</span>,
                       n.samples <span class="op">=</span> <span class="fl">30</span>,
                       plot.sig.res <span class="op">=</span> <span class="fl">1</span>,
                       n.replicates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>We can plot just the final simulated proxy records.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/PlotPFMs.html">PlotPFMs</a></span><span class="op">(</span><span class="va">PFM.5.reps</span>, plot.stages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulated.proxy"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>But they are hard to distinguish, so we will extract the results and make our own custom plot. The output is a list.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">PFM.5.reps</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $names</span>
<span class="co">## [1] "simulated.proxy"  "smoothed.signal"  "everything"       "calibration.pars"</span>
<span class="co">## </span>
<span class="co">## $class</span>
<span class="co">## [1] "sedproxy.pfm"</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">PFM.5.reps</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>The first element is a dataframe/tibble with only the first replicate. The second is a smoothed version of the climate signal. The poorly named element “everything” is what we want, this contains all the replicate simulated proxies in a large long format dataframe/tibble.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PFM.5.reps</span><span class="op">$</span><span class="va">everything</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 28,839 × 7</span></span>
<span class="co">##    timepoints n.samples replicate stage             value scale       label     </span>
<span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>          1        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>        101        30         1 proxy.bt.sb.sampY  28.8 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>        201        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>        301        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>        401        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>        501        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>        601        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>        701        30         1 proxy.bt.sb.sampY  28.6 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>        801        30         1 proxy.bt.sb.sampY  28.6 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>        901        30         1 proxy.bt.sb.sampY  28.7 Proxy units (4) +Alia…</span>
<span class="co">## <span style="color: #949494;"># … with 28,829 more rows</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PFM.5.reps</span><span class="op">$</span><span class="va">everything</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stage</span> <span class="op">==</span> <span class="st">"simulated.proxy"</span>,
         <span class="va">replicate</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timepoints</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<div class="section level4">
<h4 id="with-base-r">With base R<a class="anchor" aria-label="anchor" href="#with-base-r"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">PFM.5.reps</span><span class="op">$</span><span class="va">everything</span>, <span class="va">stage</span> <span class="op">==</span> <span class="st">"simulated.proxy"</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">value</span><span class="op">~</span><span class="va">timepoints</span>,
     col <span class="op">=</span> <span class="va">replicate</span>,
     type <span class="op">=</span> <span class="st">"n"</span>,
     data <span class="op">=</span> <span class="va">reps</span><span class="op">)</span>
  
  <span class="va">n.reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">reps</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span><span class="op">)</span>
  <span class="va">colrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="va">n.reps</span><span class="op">)</span>
  
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">reps</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">value</span><span class="op">~</span><span class="va">timepoints</span>,
     col <span class="op">=</span> <span class="va">colrs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
     data <span class="op">=</span> <span class="va">reps</span><span class="op">[</span><span class="va">reps</span><span class="op">$</span><span class="va">replicate</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span><span class="op">)</span>
  <span class="op">}</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
</div>
</div>
<div class="section level3">
<h3 id="influence-of-sample-sizes">Influence of sample sizes<a class="anchor" aria-label="anchor" href="#influence-of-sample-sizes"></a>
</h3>
<p>Here we use sedproxy to examine the influence of the number of forams per sample and the number of samples measured per depth/timepoint/sediment slice.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pfm.30</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>
  clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
  timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
  <span class="co">#calibration.type = "MgCa",</span>
  sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
  habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
  sigma.meas <span class="op">=</span> <span class="fl">0.26</span>, sigma.ind <span class="op">=</span> <span class="fl">2</span>,
  n.samples <span class="op">=</span> <span class="fl">30</span>,
  n.replicates <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>

<span class="va">pfm.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>
  clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
  timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
  <span class="co">#calibration.type = "MgCa",</span>
  sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
  habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
  sigma.meas <span class="op">=</span> <span class="fl">0.26</span>, sigma.ind <span class="op">=</span> <span class="fl">2</span>,
  n.samples <span class="op">=</span> <span class="fl">5</span>,
  n.replicates <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>


<span class="co"># Here we take a shortcut. Instead of actually simulating the measurement of 6 samples at each timepoint we just shrink sigma.meas by sqrt(6) and multiply the number of forams by 6.</span>

<span class="va">pfm.5x6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>
  clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
  timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
  <span class="co">#calibration.type = "MgCa",</span>
  sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
  habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
  sigma.meas <span class="op">=</span> <span class="fl">0.26</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>,
  sigma.ind <span class="op">=</span> <span class="fl">2</span>, n.samples <span class="op">=</span> <span class="fl">6</span><span class="op">*</span><span class="fl">5</span>,
  n.replicates <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>

<span class="va">pfm.120</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>
  clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
  timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
  <span class="co">#calibration.type = "MgCa",</span>
  sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
  habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
  sigma.meas <span class="op">=</span> <span class="fl">0.26</span>,
  sigma.ind <span class="op">=</span> <span class="fl">2</span>, n.samples <span class="op">=</span> <span class="fl">120</span>,
  n.replicates <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>

<span class="va">pfm.10x12</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ClimToProxyClim.html">ClimToProxyClim</a></span><span class="op">(</span>
  clim.signal <span class="op">=</span> <span class="va">clim.in</span>,
  timepoints <span class="op">=</span> <span class="va">req.timepoints</span>,
  <span class="co">#calibration.type = "MgCa",</span>
  sed.acc.rate <span class="op">=</span> <span class="fl">50</span>,
  habitat.weights <span class="op">=</span> <span class="va">hab.wts</span>,
  sigma.meas <span class="op">=</span> <span class="fl">0.26</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,
  sigma.ind <span class="op">=</span> <span class="fl">2</span>, n.samples <span class="op">=</span> <span class="fl">10</span><span class="op">*</span><span class="fl">12</span>,
  n.replicates <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></code></pre></div>
<p>Combine the three different measurement strategies and plot.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">combined.pfms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>`5 forams` <span class="op">=</span> <span class="va">pfm.5</span><span class="op">$</span><span class="va">everything</span>,
                           `30 forams` <span class="op">=</span> <span class="va">pfm.30</span><span class="op">$</span><span class="va">everything</span>, 
                           <span class="co">#`6*5 forams` = pfm.5x6$everything, </span>
                           `120 forams` <span class="op">=</span> <span class="va">pfm.120</span><span class="op">$</span><span class="va">everything</span>, 
                           `10x12 forams` <span class="op">=</span> <span class="va">pfm.10x12</span><span class="op">$</span><span class="va">everything</span>, 
                           .id <span class="op">=</span> <span class="st">"measurement.strategy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>measurement.strategy <span class="op">=</span> 
           <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">measurement.strategy</span>,
                  ordered <span class="op">=</span> <span class="cn">TRUE</span>,
                  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5 forams"</span>, <span class="st">"30 forams"</span>, <span class="st">"120 forams"</span>, <span class="st">"10x12 forams"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">combined.pfms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stage</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulated.proxy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timepoints</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">measurement.strategy</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="summarise-the-error">Summarise the error<a class="anchor" aria-label="anchor" href="#summarise-the-error"></a>
</h3>
<p>We can take the mean and standard deviation across replicates for each timepoint and plot this instead.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean.error</span> <span class="op">&lt;-</span> <span class="va">combined.pfms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">timepoints</span>, <span class="va">measurement.strategy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>


<span class="va">mean.error</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stage</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulated.proxy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">timepoints</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">sd</span>, ymin <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">sd</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.2</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">measurement.strategy</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-to-sedproxy_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p>And finally we can summarise the error for each measurement strategy.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean.error</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stage</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"simulated.proxy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">stage</span>, <span class="va">measurement.strategy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sd</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">stage</th>
<th align="left">measurement.strategy</th>
<th align="right">mean.error</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">simulated.proxy</td>
<td align="left">5 forams</td>
<td align="right">1.0444357</td>
</tr>
<tr class="even">
<td align="left">simulated.proxy</td>
<td align="left">30 forams</td>
<td align="right">0.4872122</td>
</tr>
<tr class="odd">
<td align="left">simulated.proxy</td>
<td align="left">120 forams</td>
<td align="right">0.3317448</td>
</tr>
<tr class="even">
<td align="left">simulated.proxy</td>
<td align="left">10x12 forams</td>
<td align="right">0.2220948</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="cited-literature">Cited literature<a class="anchor" aria-label="anchor" href="#cited-literature"></a>
</h2>
<p>Dolman, A. M. and Laepple, T.: Sedproxy: a forward model for sediment-archived climate proxies, Climate of the Past, 14(12), 1851–1868, <a href="doi:https://doi.org/10.5194/cp-14-1851-2018" class="external-link uri">doi:https://doi.org/10.5194/cp-14-1851-2018</a>, 2018.</p>
<p>Rosenthal, Y., Oppo, D. W. and Linsley, B. K.: The amplitude and phasing of climate change during the last deglaciation in the Sulu Sea, western equatorial Pacific, Geophys. Res. Lett., 30(8), 1428, <a href="doi:10.1029/2002GL016612" class="uri">doi:10.1029/2002GL016612</a>, 2003.</p>
<p>Shakun, J. D., Clark, P. U., He, F., Marcott, S. A., Mix, A. C., Liu, Z., Otto-Bliesner, B., Schmittner, A. and Bard, E.: Global warming preceded by increasing carbon dioxide concentrations during the last deglaciation, Nature, 484(7392), 49–54, <a href="doi:10.1038/nature10915" class="uri">doi:10.1038/nature10915</a>, 2012.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Laepple, Andrew Dolman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
